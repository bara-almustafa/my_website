# Unauthenticated Information Gathering - methodology 1

#### Automated Tools

1-  Generate nmap output files (with targets in `targets.txt`):

```bash
nmap -oA nmap-out -sV -p- -vv -iL targets.txt
```

2-  For tests with lots of web hosts, grab screenshots with a tool like [gowitness](https://github.com/sensepost/gowitness)

3- Import nmap findings into Metasploit

```bash
# create a new workspace
workspace -a <target name>
```

```bash
# import the file
db_import nmap-out.xml
```

```
# view 5060 and 2000 to see if they are legit (they probably are not)
services -p 5060,2000
```

```
# delete them
services -p 5060,2000 -d
```

4- Use Metasploit modules for web dir/file enumeration

```basic
msfconsole
spool dir-scanner.txt
use auxiliary/scanner/http/dir_scanner
set DICTIONARY <path>/<to>/<wordlist> ex:/usr/share/wordlists/SecLists/Discovery/Web-Content/common.txt

services -u -p 80 --rhosts
set rport 80
set ssl false
run

services -u -p 443 --rhosts
set rport 443
set ssl true
run

# repeat for other web ports (8443, 8080, etc)

```

5-  Check for anonymous SMB shares with `auxiliary/scanner/smb/smb_enumshares`.

6-  Check for open NFS shares with `auxiliary/scanner/nfs/nfsmount`.

7-   Check for anonymous FTP shares with `auxiliary/scanner/ftp/anonymous`.

8- Create a list of machines that are not configured to do SMB signing (for relaying later on).

* crackmapexec '--gen-relay-list'

**Manual Review:**

1-  Identify all URLs that allow logins.

2- Manually review screenshots from all HTTP services

### Obtaining Credentials:

1- Responder attack.

* First, run in analyze mode. Determine blue-teamy stuff and then run configure Responder.conf to not respond to those IP

2-  Execute an [ipv6 mitm](https://github.com/fox-it/mitm6) attack

3- Getting action from standard responder or mitm6? Use [Impacket](https://github.com/SecureAuthCorp/impacket)'s ntlmrelay.py to dump SAM and/or get interactive SMB shells.

4- Start cracking any received challenge/response data.

5- Wireless WPA-Enterprise attacks to gather usernames, hashes, and passwords.

* [airgeddon](https://github.com/v1s1t0r1sh3r3/airgeddon) is a nice automation tool for hostapd-wpe.

6- Find any printer admin pages? Try default creds and look for LDAP integration

7-  Drop a few USB sticks in the conference rooms (don't push the scope!).

* Internal password spray:
  * Metasploit's `auxiliary/scanner/smb/smb_login`.
  * [CrackMapExec](https://github.com/byt3bl33d3r/CrackMapExec).

### Authenticated Information Gathering

1-  Manually review scripts in `\\domain_name\netlogon`

* Don't just look for passwords - look for references to dev environments, deployment servers, etc.

2-   Run the [Sharphound](https://github.com/BloodHoundAD/SharpHound) injestor and map paths in Bloodhound.

3-   Rummage through shares.

4- Rummage through Sharepoint, e-mail, etc.

* &#x20;Look for anything related to new accounts and passwords resets. IT often uses standard passwords for these. If you find one, spray it around.

5- Enumerate and map network connectivity with a tool like [leprechaun](https://blog.vonahi.io/post-exploitation-with-leprechaun/).

### Initial Foothold

* \[ ]

### Local Privilege Escalation

1- Try [WindowsEnum](https://github.com/absolomb/WindowsEnum) or similar script to cover the basics.

2- Use a test machine to observe procmon.exe for vendor 0-days (writable DLL and service paths, etc)

### Domain Privilege Escalation

1- Get SPNs (Kerberoast - get that GPU humming!)

2-  Run [Grouper](https://github.com/l0ss/Grouper2)

3- Running SQL servers? Try for authenticated SQL/SMB relay with `auxiliary/admin/mssql/mssql_ntlm_stealer`

4-  Leverage existing credentials to get more credentials or passable hashes.

* crackmapexec '--sam'
* crackmapexec '--lsa'
* crackmapexec '-M mimikatz'
* Windows Task Manager or procdump.exe to dump lsass and use mimikatz or [pypykatz](https://github.com/skelsec/pypykatz)

5-  Find logged in users and sessions on boxes you have admin rights to.

* crackmapexec '--loggedon-users'
* crackmapexec '--sessions'

6-  Review Bloodhound path's to DA with:

* All currently compromised accounts
* All logged-on users on boxes you have admin rights to

### Objective Hunting

1-  Use Impacket's secretsdump.py to access credentials for specific accounts you need.

***

Reference:&#x20;

[https://github.com/initstring/pentest-methodology/blob/master/internal-ad.md#manual-review](https://github.com/initstring/pentest-methodology/blob/master/internal-ad.md#manual-review)



\


\


\


\


\


\


\


\


\


\


\


\




\


\




